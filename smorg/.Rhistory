geom_vline(xintercept = nugIncept, col = "navy") + labs(x="", y="Ratio", fill="Age")
df2[, c("province", "district", "date", "majEthnic", "secure")] %>% group_by(date, majEthnic, secure) %>% tally %>% filter(!is.na(secure)) %>%
ggplot(aes(date, n, fill = majEthnic)) + geom_area(position = "fill") + facet_wrap(~secure) + theme_bw() + geom_vline(xintercept = nugIncept, col = "navy") +
labs(x="", y="Ratio", fill="Age", title="") + theme(axis.text.x = element_text(angle = 90, vjust = .5), plot.title = element_text(hjust = .5))
df2[, c("province", "district", "date", "majEthnic", "grade")] %>% group_by(date, majEthnic, grade) %>% tally %>% filter(!is.na(grade)) %>%
ggplot(aes(date, n, fill = majEthnic)) + geom_area(position = "fill") + facet_wrap(~grade) + theme_bw() + geom_vline(xintercept = nugIncept, col = "navy") +
labs(x="", y="Ratio", fill="Age", title="") + theme(axis.text.x = element_text(angle = 90, vjust = .5), plot.title = element_text(hjust = .5))
df2[, c("province", "district", "date", "majEthnic", "highway")] %>% group_by(date, majEthnic, highway) %>% tally %>%
ggplot(aes(date, n, fill = majEthnic)) + geom_area(position = "fill") + facet_wrap(~highway) + theme_bw() + geom_vline(xintercept = nugIncept, col = "navy") +
labs(x="", y="Ratio", fill="Age", title="") + theme(axis.text.x = element_text(angle = 90, vjust = .5), plot.title = element_text(hjust = .5))
df2[, c("province", "district", "date", "majEthnic", "ageGrps2")] %>% group_by(date, majEthnic, ageGrps2) %>% tally %>% filter(!is.na(ageGrps2)) %>%
ggplot(aes(date, n, fill = majEthnic)) + geom_area(position = "fill") + facet_wrap(~ageGrps2) + theme_bw() + geom_vline(xintercept = nugIncept, col = "navy") +
labs(x="", y="Ratio", fill="Age", title="") + theme(axis.text.x = element_text(angle = 90, vjust = .5), plot.title = element_text(hjust = .5))
df2[, c("province", "district", "date", "majEthnic", "education")] %>% group_by(date, majEthnic, education) %>% tally %>% filter(!is.na(education)) %>%
ggplot(aes(date, n, fill = majEthnic)) + geom_area(position = "fill") + facet_wrap(~education) + theme_bw() + geom_vline(xintercept = nugIncept, col = "navy") +
labs(x="", y="Ratio", fill="Age", title="") + theme(axis.text.x = element_text(angle = 90, vjust = .5), plot.title = element_text(hjust = .5))
df2[, c("province", "district", "date", "majEthnic", "native")] %>% group_by(date, majEthnic, native) %>% tally %>% filter(!is.na(native)) %>%
ggplot(aes(date, n, fill = majEthnic)) + geom_area(position = "fill") + facet_wrap(~native) + theme_bw() + geom_vline(xintercept = nugIncept, col = "navy") +
labs(x="", y="Ratio", fill="Age", title="") + theme(axis.text.x = element_text(angle = 90, vjust = .5), plot.title = element_text(hjust = .5))
df2[, c("province", "district", "date", "majEthnic", "competitiveHiring")] %>% group_by(date, majEthnic, competitiveHiring) %>% tally %>% filter(!is.na(competitiveHiring)) %>%
ggplot(aes(date, n, fill = majEthnic)) + geom_area(position = "fill") + facet_wrap(~competitiveHiring) + theme_bw() + geom_vline(xintercept = nugIncept, col = "navy") +
labs(x="", y="Ratio", fill="Age", title="") + theme(axis.text.x = element_text(angle = 90, vjust = .5), plot.title = element_text(hjust = .5))
df2[, c("prov", "district", "date", "native")] %>% group_by(date, native) %>% tally %>% ggplot(aes(date, n, fill = native)) + geom_area() + theme_bw() +
geom_vline(xintercept = nugIncept, col = "navy") + labs(x="", y="Ratio", fill="Age")
df2[, c("province", "district", "date", "native", "secure")] %>% group_by(date, native, secure) %>% tally %>% filter(!is.na(secure)) %>%
ggplot(aes(date, n, fill = native)) + geom_area(position = "fill") + facet_wrap(~secure) + theme_bw() + geom_vline(xintercept = nugIncept, col = "navy") +
labs(x="", y="Ratio", fill="Age", title="") + theme(axis.text.x = element_text(angle = 90, vjust = .5), plot.title = element_text(hjust = .5))
df2[, c("province", "district", "date", "native", "border")] %>% group_by(date, native, border) %>% tally %>%
ggplot(aes(date, n, fill = native)) + geom_area(position = "fill") + facet_wrap(~border) + theme_bw() + geom_vline(xintercept = nugIncept, col = "navy") +
labs(x="", y="Ratio", fill="Age", title="") + theme(axis.text.x = element_text(angle = 90, vjust = .5), plot.title = element_text(hjust = .5))
df2[, c("province", "district", "date", "native", "suburb")] %>% group_by(date, native, suburb) %>% tally %>%
ggplot(aes(date, n, fill = native)) + geom_area(position = "fill") + facet_wrap(~suburb) + theme_bw() + geom_vline(xintercept = nugIncept, col = "navy") +
labs(x="", y="Ratio", fill="Age", title="") + theme(axis.text.x = element_text(angle = 90, vjust = .5), plot.title = element_text(hjust = .5))
df2[, c("province", "district", "date", "native", "suburb")] %>% group_by(date, native, suburb) %>% tally %>%
ggplot(aes(date, n, fill = native)) + geom_area(position = "fill") + facet_wrap(~suburb) + theme_bw() + geom_vline(xintercept = nugIncept, col = "navy") +
labs(x="", y="Ratio", fill="", title="") + theme(axis.text.x = element_text(angle = 90, vjust = .5), plot.title = element_text(hjust = .5))
df2[, c("province", "district", "date", "native", "mines")] %>% group_by(date, native, mines) %>% tally %>% filter(!is.na(mines)) %>%
ggplot(aes(date, n, fill = native)) + geom_area(position = "fill") + facet_wrap(~mines) + theme_bw() + geom_vline(xintercept = nugIncept, col = "navy") +
labs(x="", y="Ratio", fill="Age", title="") + theme(axis.text.x = element_text(angle = 90, vjust = .5), plot.title = element_text(hjust = .5))
df2[, c("province", "district", "date", "native", "competitiveHiring")] %>% group_by(date, native, competitiveHiring) %>% tally %>% filter(!is.na(competitiveHiring)) %>%
ggplot(aes(date, n, fill = native)) + geom_area(position = "fill") + facet_wrap(~competitiveHiring) + theme_bw() + geom_vline(xintercept = nugIncept, col = "navy") +
labs(x="", y="Ratio", fill="Age", title="") + theme(axis.text.x = element_text(angle = 90, vjust = .5), plot.title = element_text(hjust = .5))
df %>% filter(!is.na(firstname))
df %>% filter(!is.na(firstname), startdate != as.Date("1393-01-01"))
df %>% filter(!is.na(firstname), startdate != as.Date("1393-01-01")) %>% group_by(prov, district, firstname)
df %>% filter(!is.na(firstname), startdate != as.Date("1393-01-01")) %>% group_by(prov, district, firstname) %>% tally
df %>% filter(!is.na(firstname), startdate != as.Date("1393-01-01")) %>% group_by(prov, district, firstname)
df %>% filter(!is.na(firstname), startdate != as.Date("1393-01-01")) %>% group_by(prov, district, firstname) %>% tally
df %>% filter(!is.na(firstname), startdate != as.Date("1393-01-01")) %>% group_by(prov, district, firstname) %>% tally
df %>% filter(!is.na(firstname), startdate != as.Date("1393-01-01")) %>% group_by(prov, district, firstname, competitiveHiring) %>% tally
df %>% filter(!is.na(firstname), startdate != as.Date("1393-01-01")) %>% group_by(prov, district, firstname, competitiveHiring) %>% tally
df %>% filter(!is.na(firstname), startdate != as.Date("1393-01-01")) %>% group_by(prov, district, firstname, competitiveHiring)
df %>% filter(!is.na(firstname), startdate != as.Date("1393-01-01")) %>% group_by(prov, district, firstname, competitiveHiring) %>% tally
nugIncept
df %>% filter(!is.na(firstname), startdate > nugIncept) %>% group_by(prov, district, firstname, startdate, competitiveHiring) %>% tally
df %>% filter(!is.na(firstname), startdate > nugIncept) %>% group_by(prov, district, firstname, startdate, competitiveHiring) %>% tally %>% mutate(startdate = year(startdate))
df %>% filter(!is.na(firstname), startdate > nugIncept) %>% group_by(prov, district, firstname, startdate, competitiveHiring) %>% tally
df %>% filter(!is.na(firstname), startdate > nugIncept) %>% group_by(prov, district, firstname, startdate, competitiveHiring) %>% tally %>% mutate(startdate = year(startdate))
df %>% filter(!is.na(firstname), startdate > nugIncept) %>% {.[, c("prov", "district", "firstname", "startdate", Æ)]} %>% mutate(startdate = year(startdate))
df %>% filter(!is.na(firstname), startdate > nugIncept) %>% {.[, c("prov", "district", "firstname", "startdate", "competitiveHiring")]} %>% mutate(startdate = year(startdate))
df %>% filter(!is.na(firstname), startdate > nugIncept) %>% {.[, c("prov", "district", "firstname", "startdate", "competitiveHiring")]} %>% mutate(startdate = year(startdate)) %>% group_by(province, startdate, competitiveHiring)
df %>% filter(!is.na(firstname), startdate > nugIncept) %>% {.[, c("prov", "district", "firstname", "startdate", "competitiveHiring")]} %>% mutate(startdate = year(startdate)) %>% group_by(province, startdate, competitiveHiring) %>% tally
df %>% filter(!is.na(firstname), startdate > nugIncept) %>% {.[, c("prov", "district", "firstname", "startdate", "competitiveHiring")]} %>% mutate(startdate = year(startdate)) %>% group_by(prov, startdate, competitiveHiring) %>% tally
df %>% filter(!is.na(firstname), startdate > nugIncept) %>% {.[, c("prov", "district", "firstname", "startdate")]} %>% mutate(startdate = year(startdate)) %>% group_by(prov, startdate) %>% tally
df %>% filter(!is.na(firstname), startdate > nugIncept) %>% {.[, c("prov", "district", "firstname", "startdate")]} %>% mutate(startdate = year(startdate)) %>% group_by(prov, startdate) %>% tally %>%
spread(startdate, n)
df %>% filter(!is.na(firstname), startdate > nugIncept) %>% {.[, c("prov", "district", "firstname", "startdate")]} %>% mutate(startdate = year(startdate)) %>% group_by(prov, startdate) %>% tally %>%
spread(startdate, n) %>% mutate(appmt = sum(`1393`, `1394`, `1395`, `1396`, na.rm = T))
df %>% filter(!is.na(firstname), startdate > nugIncept) %>% {.[, c("prov", "district", "firstname", "startdate")]} %>% mutate(startdate = year(startdate)) %>% group_by(prov, startdate) %>% tally %>%
spread(startdate, n) %>% mutate(appmt = sum(`1393`, `1394`, `1395`, `1396`, na.rm = T)) %>% arrange(desc(appmt))
df %>% filter(!is.na(firstname), startdate > nugIncept) %>% {.[, c("province", "district", "firstname", "startdate")]} %>% mutate(startdate = year(startdate)) %>% group_by(prov, startdate) %>% tally %>%
spread(startdate, n) %>% mutate(appmt = sum(`1393`, `1394`, `1395`, `1396`, na.rm = T)) %>% arrange(desc(appmt))
df %>% filter(!is.na(firstname), startdate > nugIncept) %>% {.[, c("province", "district", "firstname", "startdate")]} %>% mutate(startdate = year(startdate)) %>% group_by(province, startdate) %>% tally %>%
spread(startdate, n) %>% mutate(appmt = sum(`1393`, `1394`, `1395`, `1396`, na.rm = T)) %>% arrange(desc(appmt))
df %>% filter(!is.na(firstname), startdate > nugIncept) %>% {.[, c("province", "district", "firstname", "startdate")]} %>% mutate(startdate = year(startdate)) %>% group_by(province, startdate) %>% tally %>%
spread(startdate, n) %>% mutate(appmt = sum(`1393`, `1394`, `1395`, `1396`, na.rm = T)) %>% arrange(desc(appmt)) %>% kable(col.names = c("Province", "1393*", "1394", "1395", "1396", "Total Appointments"))
nugIncept
df %>% filter(!is.na(firstname), startdate > nugIncept) %>% {.[, c("province", "district", "firstname", "startdate")]} %>% mutate(startdate = year(startdate)) %>% group_by(province, startdate) %>% tally %>% spread(startdate, n) %>%
mutate(appmt = sum(`1393`, `1394`, `1395`, `1396`, na.rm = T)) %>% arrange(desc(appmt)) %>% kable(col.names = c("Province", "1393*", "1394", "1395", "1396", "Total Appointments"), caption = "Number of Appointments of District Governors Since the Inception of NUG on `r nugIncept`")
seq <- seq.Date(as.Date("1393-01-01"), as.Date("1396-12-30"), by = "day")
seq
seq <- seq.Date(as.Date("1393-01-01"), as.Date("1396-12-30"), by = "day")
rec <- numeric()
for (i in seq) {
rec <- c(rec, filter(df, !is.na(firstname), startdate = as.Date(i, origin = "1970-01-01")) %>% nrow())
}
rec <- c(rec, filter(df, !is.na(firstname), startdate == as.Date(i, origin = "1970-01-01")) %>% nrow())
for (i in seq) {
rec <- c(rec, filter(df, !is.na(firstname), startdate == as.Date(i, origin = "1970-01-01")) %>% nrow())
}
rec
data.frame(seq, rec)
seq <- seq.Date(as.Date("1393-01-01"), as.Date("1396-12-30"), by = "day")
rec <- numeric()
for (i in seq) {
rec <- c(rec, filter(df, !is.na(firstname), startdate == as.Date(i, origin = "1970-01-01")) %>% nrow())
}
for (i in seq) {
rec <- c(rec, filter(df, !is.na(firstname), startdate == as.Date(i, origin = "1970-01-01")) %>% nrow())
}
data.frame(seq, rec)
data.frame(seq, rec) %>% filter(seq > as.Date("1393-01-01")) %>% ggplot(aes(seq, rec)) + geom_col()
data.frame(seq, rec) %>% filter(seq > as.Date("1393-01-01")) %>% ggplot(aes(seq, rec)) + geom_line() + theme()
data.frame(seq, rec) %>% filter(seq > as.Date("1393-01-01")) %>% ggplot(aes(seq, rec)) + geom_line() + theme_bw()
data.frame(seq, rec) %>% filter(seq > as.Date("1393-01-01")) %>% ggplot(aes(seq, rec)) + geom_line() + geom_vline(xintercept = nugIncept) + theme_bw() +
data.frame(seq, rec) %>% filter(seq > as.Date("1393-01-01")) %>% ggplot(aes(seq, rec)) + geom_line() + geom_vline(xintercept = nugIncept, col = "red") + theme_bw() +
data.frame(seq, rec) %>% filter(seq > as.Date("1393-01-01")) %>% ggplot(aes(seq, rec)) + geom_line() + geom_vline(xintercept = nugIncept, col = "red") + theme_bw()
data.frame(seq, rec) %>% filter(seq > as.Date("1393-01-01")) %>% ggplot(aes(seq, rec)) + geom_line() + geom_vline(xintercept = nugIncept, col = "red") + theme_bw()
data.frame(seq, rec) %>% filter(seq > as.Date("1393-01-01")) %>% ggplot(aes(seq, rec)) + geom_line(alpha = .5) + geom_vline(xintercept = nugIncept, col = "red") + theme_bw()
data.frame(seq, rec) %>% filter(seq > as.Date("1393-01-01")) %>% ggplot(aes(seq, rec)) + geom_line(alpha = .5) + geom_point() + geom_vline(xintercept = nugIncept, col = "red") + theme_bw()
data.frame(seq, rec) %>% filter(seq > as.Date("1393-01-01")) %>% ggplot(aes(seq, rec)) + geom_line(alpha = .5) + geom_point(size = .3) + geom_vline(xintercept = nugIncept, col = "red") + theme_bw()
data.frame(seq, rec) %>% filter(seq > as.Date("1393-01-01")) %>% ggplot(aes(seq, rec)) + geom_line(alpha = .5) + geom_point(size = .4) + geom_vline(xintercept = nugIncept, col = "red") + theme_bw()
data.frame(seq, rec) %>% filter(seq > as.Date("1393-01-01")) %>% ggplot(aes(seq, rec)) + geom_line(alpha = .5) + geom_point(size = .4, alpha = .5) + geom_vline(xintercept = nugIncept, col = "red") + theme_bw()
data.frame(seq, rec) %>% filter(seq > as.Date("1393-01-01")) %>% ggplot(aes(seq, rec)) + geom_line(alpha = .5) + geom_point(size = .4, alpha = .4) + geom_vline(xintercept = nugIncept, col = "red") + theme_bw()
data.frame(seq, rec) %>% filter(seq > as.Date("1393-01-01")) %>% ggplot(aes(seq, rec)) + geom_line(alpha = .5) + geom_point(size = .4, alpha = .4) + geom_vline(xintercept = nugIncept, col = "red") + theme_bw() +
labs(x = "", y = "Number of Appointments")
data.frame(seq, rec) %>% filter(seq > as.Date("1393-01-01")) %>% ggplot(aes(seq, rec)) + geom_line(alpha = .5) + geom_point(size = .4, alpha = .4) + geom_vline(xintercept = nugIncept, col = "red") + theme_bw() +
labs(x = "", y = "Number of Appointments") + geom_density()
data.frame(seq, rec) %>% filter(seq > as.Date("1393-01-01")) %>% ggplot(aes(seq, rec)) + geom_line(alpha = .5) + geom_point(size = .4, alpha = .4) + geom_vline(xintercept = nugIncept, col = "red") + theme_bw() +
labs(x = "", y = "Number of Appointments") + geom_density(aes(seq, rec))
data.frame(seq, rec) %>% filter(seq > as.Date("1393-01-01")) %>% ggplot(aes(seq, rec)) + geom_line(alpha = .5) + geom_point(size = .4, alpha = .4) + geom_vline(xintercept = nugIncept, col = "red") + theme_bw() +
labs(x = "", y = "Number of Appointments") + geom_density(aes(x = seq, y = rec))
rec
data.frame(seq, rec)
data.frame(seq, rec) %>% filter(seq > as.Date("1393-01-01")) %>% ggplot(aes(seq, rec)) + geom_vline(xintercept = nugIncept, col = "red") + theme_bw() +
labs(x = "", y = "Number of Appointments") + geom_density(aes(x = seq, y = rec))
data.frame(seq, rec) %>% filter(seq > as.Date("1393-01-01")) %>% ggplot(aes(seq, rec)) + geom_vline(xintercept = nugIncept, col = "red") + theme_bw() +
labs(x = "", y = "Number of Appointments") + geom_density()
data.frame(seq, rec) %>% filter(seq > as.Date("1393-01-01")) %>% ggplot(aes(seq, rec)) + geom_vline(xintercept = nugIncept, col = "red") + theme_bw() +
labs(x = "", y = "Number of Appointments") + geom_density()
data.frame(seq, rec) %>% filter(seq > as.Date("1393-01-01")) %>% ggplot(aes(seq, rec)) + geom_line(alpha = .5) + geom_point(size = .4, alpha = .4) + geom_vline(xintercept = nugIncept, col = "red") + theme_bw() +
labs(x = "", y = "Number of Appointments")
data.frame(seq, rec)
data.frame(seq, rec) %>% filter(seq > as.Date("1393-01-01")) %>% ggplot(aes(seq, rec)) + geom_density()
data.frame(seq, rec) %>% filter(seq > as.Date("1393-01-01")) %>% ggplot(aes(rec)) + geom_density()
data.frame(seq, rec) %>% filter(seq > as.Date("1393-01-01")) %>% ggplot(aes(rec)) + geom_density() + scale_x_log10()
data.frame(seq, rec) %>% filter(seq > as.Date("1393-01-01")) %>% ggplot(aes(seq, rec)) + geom_line(alpha = .5) + geom_point(size = .4, alpha = .4) + geom_vline(xintercept = nugIncept, col = "red") + theme_bw() +
labs(x = "", y = "Number of Appointments")
df2[, c("province", "district", "date", "native", "native")] %>% group_by(date, native, native) %>% tally %>% filter(!is.na(native)) %>%
ggplot(aes(date, n, fill = native)) + geom_area(position = "fill") + facet_wrap(~native) + theme_bw() + geom_vline(xintercept = nugIncept, col = "navy") +
labs(x="", y="Ratio", fill="Age", title="") + theme(axis.text.x = element_text(angle = 90, vjust = .5), plot.title = element_text(hjust = .5))
df2[, c("province", "district", "date", "native", "majEthnic")] %>% group_by(date, native, native) %>% tally %>% filter(!is.na(native)) %>%
ggplot(aes(date, n, fill = native)) + geom_area(position = "fill") + facet_wrap(~native) + theme_bw() + geom_vline(xintercept = nugIncept, col = "navy") +
labs(x="", y="Ratio", fill="Age", title="") + theme(axis.text.x = element_text(angle = 90, vjust = .5), plot.title = element_text(hjust = .5))
df2[, c("province", "district", "date", "native", "majEthnic")] %>% group_by(date, native, majEthnic) %>% tally %>% filter(!is.na(majEthnic)) %>%
ggplot(aes(date, n, fill = native)) + geom_area(position = "fill") + facet_wrap(~native) + theme_bw() + geom_vline(xintercept = nugIncept, col = "navy") +
labs(x="", y="Ratio", fill="Age", title="") + theme(axis.text.x = element_text(angle = 90, vjust = .5), plot.title = element_text(hjust = .5))
df2[, c("province", "district", "date", "native", "majEthnic")]
df2[, c("province", "district", "date", "native", "majEthnic")] %>% group_by(date, native, majEthnic) %>% tally
df2[, c("province", "district", "date", "native", "majEthnic")] %>% group_by(date, native, majEthnic) %>% tally %>% filter(!is.na(majEthnic))
df2[, c("province", "district", "date", "native", "majEthnic")] %>% group_by(date, native, majEthnic) %>% tally %>% filter(!is.na(majEthnic)) %>%
ggplot(aes(date, n, fill = native)) + geom_area(position = "fill") + facet_wrap(~majEthnic) + theme_bw() + geom_vline(xintercept = nugIncept, col = "navy") +
labs(x="", y="Ratio", fill="", title="") + theme(axis.text.x = element_text(angle = 90, vjust = .5), plot.title = element_text(hjust = .5))
incept
nAppoint <- df %>% filter(!is.na(firstname), startdate > nugIncept) %>% {.[, c("province", "district", "firstname", "startdate")]} %>% mutate(startdate = year(startdate)) %>% group_by(province, startdate) %>% tally %>%
spread(startdate, n) %>% mutate(appmt = sum(`1393`, `1394`, `1395`, `1396`, na.rm = T)) %>% arrange(desc(appmt))
recTot <- sum(nAppoint[[6]])
recTot
df %>% filter(!is.na(firstname), startdate > nugIncept)
# DG data: version 5
require(readr)
require(dplyr)
require(beepr)
### read v4
df <- read_csv("~/Documents/My Consultancies/IDLG District Governor's Report/DG data (March 19) v4.csv")[-516,]
#1 Add district names to variable dist
df$dist[is.na(df$dist) & df$province=="Helmand" & df$district=="ولسوالی ناوه میش"] <- "Nawe Mesh"
df$dist[is.na(df$dist) & df$province=="Paktia" & df$district=="ولسوالی میرزکه"] <- "Mirzaka"
df$dist[is.na(df$dist) & df$province=="Herat" & df$district=="ولسوالی پشت کوه (مؤقت)"] <- "Poshte Koh (temp)"
df$dist[is.na(df$dist) & df$province=="Herat" & df$district=="ولسوالی زاول (مؤقت)"] <- "Zawul (temp)"
df$dist[is.na(df$dist) & df$province=="Herat" & df$district=="ولسوالی زیرکوه (مؤقت)"] <- "Zer Koh (temp)"
df$dist[is.na(df$dist) & df$province=="Herat" & df$district=="ولسوالی کوه زور (مؤقت)"] <- "Koh Zor (temp)"
df$dist[is.na(df$dist) & df$province=="Kunduz" & df$district=="ولسوال گل تیپه ( موقت)"] <- "Gultepa"
df$dist[is.na(df$dist) & df$province=="Paktika" & df$district=="ولسوالی تروو"] <- "Turwo"
df$dist[is.na(df$dist) & df$province=="Paktika" & df$district=="ولسوالی ورممي"] <- "Wormamay"
df$dist[is.na(df$dist) & df$province=="Zabul" & df$district=="ولسوالی خاک افغان"] <- "Khak-e Afghan"
#2 Add rows for missing intervals
x <- data.frame(
prov = c("بدخشان", "بدخشان", "بلخ", "بلخ", "بلخ", "بلخ", "بلخ", "پکتیکا", "پکتیکا", "خوست", "زابل", "غزنی", "غزنی", "فاریاب", "فاریاب", "فاریاب", "فاریاب", "فاریاب", "فاریاب", "فاریاب", "فاریاب", "کندز", "کندز", "کندز", "ننگرهار", "بلخ"),
district = c("ولسوالی اشكاشم", "ولسوالی ارگو", "ولسوالی نهرشاهي", "ولسوالی خلم", "ولسوالی كلدار", "ولسوالی چاركنت", "ولسوالی بلخ", "ولسوالی ديله", "ولسوالی جاني خيل", "ولسوالی قلندر", "ولسوالی شمل زائی", "ولسوالی ناوه", "ولسوالی گيرو", "ولسوالی شرین تگاب", "ولسوالی قرغان", "ولسوالی قرمقول", "ولسوالی خواجه سبزپوش", "ولسوالی غورماچ", "ولسوالی بلچراغ", "ولسوال اندخوی", "ولسوالی المار", "ولسوال گل تیپه ( موقت)", "ولسوال کلباد ( موقت)", "ولسوال آقتاش ( موقت)", "ولسوال حصارک", "ولسوالی مارمل"),
startdate = as.Date(c("1394-08-01", "1393-01-01", "1396-02-17", "1395-02-01", "1394-07-01", "1395-07-01", "1395-01-01", "1394-08-01", "1393-01-01", "1396-01-01", "1396-01-01", "1394-07-21", "1393-05-28", "1396-01-01", "1393-01-01", "1393-01-01", "1393-01-01", "1393-01-01", "1393-01-01", "1393-01-01", "1393-01-01", "1393-01-01", "1393-01-01", "1393-01-01", "1395-07-01", "1394-07-01")),
enddate = as.Date(c("1395-07-31", "1393-04-30", "1396-12-30", "1396-12-30", "1396-12-30", "1396-12-30", "1396-04-30", "1395-11-20", "1393-02-24", "1396-08-01", "1396-02-29", "1396-12-30", "1394-05-03", "1396-06-30", "1393-03-31", "1394-07-31", "1394-06-30", "1395-03-31", "1394-05-31", "1396-05-31", "1396-04-30", "1395-05-03", "1395-06-06", "1395-06-28", "1396-06-30", "1394-08-31")),
province = c("Badakhshan", "Badakhshan", "Balkh", "Balkh", "Balkh", "Balkh", "Balkh", "Paktika", "Paktika", "Khost", "Zabul", "Ghazni", "Ghazni", "Faryab", "Faryab", "Faryab", "Faryab", "Faryab", "Badghis", "Faryab", "Faryab", "Kunduz", "Kunduz", "Kunduz", "Nangarhar", "Balkh"),
dist = c("Eshkashim", "Argo", "Nahri Shahi", "Khulm", "Kaldar", "Charkent", "Balkh", "Dilawa Kushamand", "Jani Khel", "Qalandar", "Shemel Zayi", "Nawa", "Giro", "Shirin Tagab", "Qurghan", "Qaram Qul", "Khwaja Sabz Posh-i-Wali", "Ghormach", "Bilchiragh", "Andkhoy", "Almar", "Gultepa", "Calbad", "Akhtash", "Hesarak", "Marmul"),
status = c("Permanent", "Permanent", "Permanent", "Permanent", "Permanent", "Permanent", "Permanent", "Permanent", "Permanent", "Permanent", "Permanent", "Permanent", "Permanent", "Permanent", "Permanent", "Permanent", "Permanent", "Moved from Badghis", "Permanent", "Permanent", "Permanent", "Temporary", "Temporary", "Temporary", "Permanent", "Permanent"),
security = c("Low", "High", "Low", "Low", "Low", "Medium", "Low", "", "Medium", "High", "High", "High", "High", "Medium", "Low", "Low", "Low", "High", "Medium", "Low", "Medium", "", "", "", "High", "Low"),
border = c("Yes", "No", "No", "Yes", "Yes", "No", "No", "No", "No", "No", "Yes", "No", "No", "Yes", "Yes", "Yes", "No", "No", "No", "No", "Yes", "No", "No", "No", "No", "No"),
ports = c("Yes", "No", "Yes", "No", "Yes", "No", "No", "No", "No", "No", "No", "No", "No", "No", "No", "No", "No", "No", "No", "Yes", "No", "No", "No", "No", "No", "No"),
mines = c("Yes", "No", "Yes", "No", "No", "No", "No", "No", "No", "No", "No", "Yes", "No", "No", "No", "Yes", "No", "No", "Yes", "No", "No", "No", "No", "No", "Yes", "No"),
grade = c(2, 2, 1, 1, 2, 2, 1, 3, 2, 3, 3, 2, 3, 1, 2, 3, 2, 2, 1, 1, 2, 3, 3, 3, 2, 2),
suburb = c(0, 1, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0),
highway = c(0, 0, 0, 1, 1, 0, 1, 0, 0, 0, 0, 0, 0, 1, 0, 1, 1, 0, 0, 1, 0, 0, 0, 0, 0, 1)
)
df <- bind_rows(df, x) %>% arrange(prov, district)
#3 Fix missing and mistake enddate
df$enddate[is.na(df$enddate) & df$province == "Nooristan" & df$dist == "Mandol"] <- as.Date("1396-04-30")
df$enddate[df$province == "Badakhshan" & df$dist == "Shuhada" & df$enddate == "1396-07-31"] <- as.Date("1393-07-31")
df$enddate[df$province == "Ghor" & df$dist == "Tulak" & df$enddate == "1396-10-31"] <- as.Date("1396-08-31")
df$enddate[df$province == "Farah" & df$dist == "Gulistan" & df$enddate == "1394-12-09"] <- as.Date("1394-12-08")
df$enddate[df$province == "Khost" & df$dist == "Qalandar" & df$enddate == "1396-08-01"] <- as.Date("1396-07-31")
df$startdate[df$enddate == as.Date("1396-12-30") & df$dist == "Shigal"] <- as.Date("1395-01-01")
#4 fixing province names
df$province[df$province == "Sar-e-Pul"] <- "Sar-i-Pul"
df$pob[df$pob == "Sar-e-Pul"] <- "Sar-i-Pul"
df$province[df$province == "Nooristan"] <- "Nuristan"
df$pob[df$pob == "Nooristan"] <- "Nuristan"
df$province[df$dist == "Ghormach"] <- "Badghis"
df$prov[df$dist == "Ghormach"] <- "بادغیس"
df$province[df$dist == "Gizab"] <- "Daikundi"
df$prov[df$dist == "Gizab"] <- "دایکندی"
df$province[df$dist=="Bilchiragh"] <- "Faryab"
#5 fixing ports, mines
df$ports[df$province %in% c("Uruzgan", "Ghazni", "Zabul")] <- "No"
df$ports[df$dist %in% c("Eshkashim", "Nahri Shahi", "Dashti Qala", "Andkhoy", "Shibkoh", "Kushk-i-Kuhna")] <- "No"
df$ports[df$dist %in% c("Kushk (Rubat-i-Sangi)", "Muhmand Dara", "Khani Charbagh")] <- "Yes"
df$border[df$dist == "Khak-e Afghan"] <- "No"
df$mines[df$dist == "Arghistan"] <- "No"
#6 fixing education
df$education[df$education=="University degree"] <- "Bachelor degree"
df$education[df$education %in% c("13th Grade", "14th Grade")] <- "14th grade"
df$education <- factor(df$education, levels = c("Master's degree", "Bachelor degree", "14th grade", "School certificate", "School incomplete", "Private education"))
#7 native variable and provincial grade
df$native <- df$province == df$pob
df$provGrade <- ifelse(df$province %in% c("Kabul", "Kandahar", "Herat", "Balkh", "Nangarhar", "Kunduz", "Badakhshan", "Ghazni", "Helmand"), 1,
ifelse(df$province %in% c("Paktia", "Parwan", "Baghlan", "Jawzjan", "Farah", "Faryab", "Takhar", "Kapisa", "Khost", "Wardak", "Kunar", "Paktika", "Bamyan"), 2, 3))
#8 fixing temporary and permanent status
df$status[df$dist=="Shigal Wa Sheltan"] <- "Permanent"
#9 add security situation
df$secure <- numeric(length = nrow(df))
df$secure[df$province=="Badakhshan" & df$dist %in% c("Wardooj","Yamgan (Girwan)")] <- 1
df$secure[df$province=="Badakhshan" & df$dist %in% c("Kohistan","Raghistan")] <- 2
df$secure[df$province=="Badakhshan" & df$dist %in% c("Kiran Wa Menjan","Jurm","Arghanj Khwah")] <- 3
df$secure[df$province=="Badakhshan" & df$dist %in% c("Baharak","Yaftal-i-Sufla")] <- 4
df$secure[df$province=="Badakhshan" & df$dist %in% unique(df$dist[df$province=="Badakhshan" & df$secure==0])] <- 5
df$secure[df$province=="Badghis" & df$dist %in% c("Murghab (Bala Murghab)","Jawand")] <- 2
df$secure[df$province=="Badghis" & df$dist %in% unique(df$dist[df$province=="Badghis" & df$secure==0])] <- 3
df$secure[df$province=="Baghlan" & df$dist %in% c("Dahana-i-Ghuri")] <- 1
df$secure[df$province=="Baghlan" & df$dist %in% c("Burka")] <- 4
df$secure[df$province=="Baghlan" & df$dist %in% unique(df$dist[df$province=="Baghlan" & df$secure==0])] <- 5
df$secure[df$province=="Balkh" & df$dist %in% c("Char Bolak")] <- 3
df$secure[df$province=="Balkh" & df$dist %in% c("Marmul","Chimtal","Zari","Dawlat Abad","Shortepa")] <- 4
df$secure[df$province=="Balkh" & df$dist %in% unique(df$dist[df$province=="Balkh" & df$secure==0])] <- 5
df$secure[df$province %in% c("Bamyan","Daikundi","Panjshir","Samangan")] <- 5
df$secure[df$province=="Bamyan" & df$dist %in% c("Chihel Borj (yakawulang No 2)")] <- NA
df$secure[df$province=="Farah" & df$dist %in% c("Anar Dara","Lash-i-Juwayn")] <- 3
df$secure[df$province=="Farah" & df$dist %in% unique(df$dist[df$province=="Farah" & df$secure==0])] <- 2
df$secure[df$province=="Faryab" & df$dist %in% c("Dawlat Abad","Shirin Tagab","Khwaja Sabz Posh-i-Wali","Kohistan")] <- 3
df$secure[df$province=="Faryab" & df$dist %in% c("Gurziwan","Qaram Qul","Bilchiragh")] <- 4
df$secure[df$province=="Faryab" & df$dist %in% unique(df$dist[df$province=="Faryab" & df$secure==0])] <- 5
df$secure[df$province=="Ghazni" & df$dist %in% c("Nawa")] <- 1
df$secure[df$province=="Ghazni" & df$dist %in% c("Giro","Wali M. Shahid (Khugyani)","Gelan","Ajristan","Andar","Qara Bagh","Zanakhan","Deh Yak","Jaghatu","Waghaz")] <- 2
df$secure[df$province=="Ghazni" & df$dist %in% c("Muqur","Khwaja Omary","Ab Band","Rashidan")] <- 3
df$secure[df$province=="Ghazni" & df$dist %in% unique(df$dist[df$province=="Ghazni" & df$secure==0])] <- 4
df$secure[df$province=="Ghor" & df$dist %in% c("Pasaband","Char Sada","Taywara")] <- 2
df$secure[df$province=="Ghor" & df$dist %in% c("Shahrak","Dawlatyar","Tulak")] <- 3
df$secure[df$province=="Ghor" & df$dist %in% unique(df$dist[df$province=="Ghor" & df$secure==0])] <- 4
df$secure[df$province=="Helmand" & df$dist %in% c("Nawzad","Reg-i-Khan Nishin","Dishu","Musa Qalah","Baghran")] <- 1
df$secure[df$province=="Helmand" & df$dist %in% c("Garm Ser","Nad Ali","Sangin")] <- 2
df$secure[df$province=="Helmand" & df$dist %in% unique(df$dist[df$province=="Helmand" & df$secure==0])] <- 3
df$secure[df$province=="Helmand" & df$dist %in% c("Marjah","Nawe Mesh")] <- NA
df$secure[df$province=="Herat" & df$dist %in% c("Gulran","Kushk-i-Kuhna","Fersi","Kushk (Rubat-i-Sangi)")] <- 2
df$secure[df$province=="Herat" & df$dist %in% c("Ghoryan","Shindand","Kohsan","Zendahjan","Adraskan","Pashtun Zarghun","Obeh","Chishti Sharif","Karrukh")] <- 4
df$secure[df$province=="Herat" & df$dist %in% c("Enjil","Guzera (Nizam-i-Shahid)")] <- 5
df$secure[df$province=="Herat" & df$dist %in% c("Poshte Koh (temp)","Zawul (temp)","Zer Koh (temp)","Koh Zor (temp)")] <- NA
df$secure[df$province=="Jawzjan" & df$dist %in% c("Darzab","Khanaqa","Qush Tepa")] <- 2
df$secure[df$province=="Jawzjan" & df$dist %in% c("Aqchah","Khamyab","Mardyan")] <- 4
df$secure[df$province=="Jawzjan" & df$dist %in% unique(df$dist[df$province=="Jawzjan" & df$secure==0])] <- 5
df$secure[df$province=="Kabul" & df$dist %in% c("Deh Sabz","Musahi","Khak-i-Jabar")] <- 3
df$secure[df$province=="Kabul" & df$dist %in% c("Bagrami","Chahar Asyab","Paghman","Qara Bagh","Surubi")] <- 4
df$secure[df$province=="Kabul" & df$dist %in% unique(df$dist[df$province=="Kabul" & df$secure==0])] <- 5
df$secure[df$province=="Kandahar" & df$dist %in% c("Shorabak","Ghorak","Nesh","Reig")] <- 3
df$secure[df$province=="Kandahar" & df$dist %in% c("Arghistan","Maiwand","Maruf","Khakrez","Shah Wali Kot","Miyanishin")] <- 4
df$secure[df$province=="Kandahar" & df$dist %in% c("Panjwayee","Spin Boldak","Zhire","Arghandab","Daman")] <- 5
df$secure[df$province=="Kandahar" & df$dist %in% c("Takhtapol","Dand")] <- NA
df$secure[df$province=="Kapisa" & df$dist %in% c("Alasai")] <- 2
df$secure[df$province=="Kapisa" & df$dist %in% c("Nijrab")] <- 4
df$secure[df$province=="Kapisa" & df$dist %in% unique(df$dist[df$province=="Kapisa" & df$secure==0])] <- 5
df$secure[df$province=="Khost" & df$dist %in% c("Qalandar")] <- 1
df$secure[df$province=="Khost" & df$dist %in% c("Tirzayee (Ali Sher)")] <- 2
df$secure[df$province=="Khost" & df$dist %in% c("Sabari (Yaqubi)","Nadir Shah kot")] <- 3
df$secure[df$province=="Khost" & df$dist %in% c("Baak","Musa khel","Spera")] <- 4
df$secure[df$province=="Khost" & df$dist %in% unique(df$dist[df$province=="Khost" & df$secure==0])] <- 5
df$secure[df$province=="Kunar" & df$dist %in% c("Ghazi Abad","Dangam","Chapa Dara","Nari","Watapoor")] <- 2
df$secure[df$province=="Kunar" & df$dist %in% c("Dara-i-Pech","Shigal Wa Sheltan","Bar Kunar","Sar Kani")] <- 3
df$secure[df$province=="Kunar" & df$dist %in% c("Noorgal","Mara wara","Narang Wa Badil","Sawkai","Khas Kunar")] <- 4
df$secure[df$province=="Kunar" & df$dist %in% c("Shigal")] <- NA
df$secure[df$province=="Kunduz" & df$dist %in% c("Qala-i-Zal","Char Darah","Hazrati Imam Sahib","Dasht-i-Archi","Khan Abad")] <- 2
df$secure[df$province=="Kunduz" & df$dist %in% c("Ali Abad")] <- 4
df$secure[df$province=="Kunduz" & df$dist %in% c("Akhtash","Calbad","Gultepa")] <- NA
df$secure[df$province=="Laghman" & df$dist %in% c("Alishing","Alingar","Dawlat Shah")] <- 3
df$secure[df$province=="Laghman" & df$dist %in% c("Qarghayee")] <- 5
df$secure[df$province=="Laghman" & df$dist %in% c("Bad Pech")] <- NA
df$secure[df$province=="Logar" & df$dist %in% c("Kharwar")] <- 2
df$secure[df$province=="Logar" & df$dist %in% c("Baraki Barak","Charkh")] <- 3
df$secure[df$province=="Logar" & df$dist %in% c("Mohammad Agha","Azra","Khushi")] <- 4
df$secure[df$province=="Nangarhar" & df$dist %in% c("Sher Zad","Hesarak")] <- 2
df$secure[df$province=="Nangarhar" & df$dist %in% c("Chapar har","Deh Bala")] <- 3
df$secure[df$province=="Nangarhar" & df$dist %in% c("Khogyani","Shinwar","Kot","Achin","Surkh Rud","Nazyan","Lalpoor","Bati Kot","Pachir Waagam","Muhmand Dara")] <- 4
df$secure[df$province=="Nangarhar" & df$dist %in% c("Dur Baba","Rodat","Kama","Kuzkunar","Behsud","Goshta","Darah-i-Noor")] <- 5
df$secure[df$province=="Nimroz" & df$dist %in% c("Khashrod")] <- 4
df$secure[df$province=="Nimroz" & df$dist %in% c("Kang","Asl-i-chakhansur","Char Burjak")] <- 5
df$secure[df$province=="Nimroz" & df$dist %in% c("Dularam")] <- NA
df$secure[df$province=="Nuristan" & df$dist %in% c("Kamdesh","Waygal","Bargi Matal")] <- 3
df$secure[df$province=="Nuristan" & df$dist %in% c("Duab")] <- 4
df$secure[df$province=="Nuristan" & df$dist %in% c("Noor Gram","Wama","Mandol")] <- 5
df$secure[df$province=="Paktika" & df$dist %in% c("Nika","Giyan")] <- 1
df$secure[df$province=="Paktika" & df$dist %in% c("Omna","Ziruk","Dilawa Kushamand","Gomal")] <- 2
df$secure[df$province=="Paktika" & df$dist %in% c("Jani Khel")] <- 3
df$secure[df$province=="Paktika" & df$dist %in% c("Sar Rawza","Surubi","Barmal","Wazakhwah","Wormamay","Turwo")] <- 4
df$secure[df$province=="Paktika" & df$dist %in% c("Yosuf Kheil","Urgoon","Mata Khan","Yahya Kheil","Zarghun Shahr")] <- 5
df$secure[df$province=="Paktia" & df$dist %in% c("Jaji")] <- 2
df$secure[df$province=="Paktia" & df$dist %in% c("Zurmat","Laja Ahmad khel","Jani Khel")] <- 3
df$secure[df$province=="Paktia" & df$dist %in% c("Dand Patan")] <- 4
df$secure[df$province=="Paktia" & df$dist %in% c("Samkani","Shwak","Waza Zadran","Sayyid Karam","Ahmadaba")] <- 5
df$secure[df$province=="Paktia" & df$dist %in% c("Laja Mangel","Mirzaka")] <- NA
df$secure[df$province=="Panjshir" & df$dist %in% c("Ab Shar")] <- NA
df$secure[df$province=="Parwan" & df$dist %in% c("Syahgird (Ghurband)","Kohi-i-Safi","Shinwari")] <- 2
df$secure[df$province=="Parwan" & df$dist %in% c("Shaykhali","Jabulusaraj","Bagram")] <- 3
df$secure[df$province=="Parwan" & df$dist %in% c("Surkhi parsa","Salang","Sayyid Khel")] <- 4
df$secure[df$province=="Sar-i-Pul" & df$dist %in% c("Kohistanat")] <- 1
df$secure[df$province=="Sar-i-Pul" & df$dist %in% c("Sayyad")] <- 3
df$secure[df$province=="Sar-i-Pul" & df$dist %in% c("Balkhab","Sozma Qala","Sangcharak","Gosfandi")] <- 4
df$secure[df$province=="Takhar" & df$dist %in% c("Khwaja Bahawuddin","Yangi Qala","Darqad")] <- 2
df$secure[df$province=="Takhar" & df$dist %in% c("Bangi")] <- 3
df$secure[df$province=="Takhar" & df$dist %in% c("Dashti Qala","Eshkamesh","Khwaja Ghar")] <- 4
df$secure[df$province=="Takhar" & df$dist %in% c("Warsaj","Namak Ab","Farkhar","Baharak","Hazar Sumuch","Kalafgan","Chal","Rustag","Chahab")] <- 5
df$secure[df$province=="Uruzgan" & df$dist %in% c("Khas Urozgan")] <- 2
df$secure[df$province=="Uruzgan" & df$dist %in% c("Chora","Shahidhassas")] <- 3
df$secure[df$province=="Uruzgan" & df$dist %in% c("Dehraoud")] <- 4
df$secure[df$province=="Uruzgan" & df$dist %in% c("Chinarto")] <- NA
df$secure[df$province=="Wardak" & df$dist %in% c("Jaghatu","Daimir Dad")] <- 2
df$secure[df$province=="Wardak" & df$dist %in% c("Chak-i-Wardak")] <- 3
df$secure[df$province=="Wardak" & df$dist %in% c("Jalrez","Sayyid Abad","Nerkh")] <- 4
df$secure[df$province=="Wardak" & df$dist %in% c("Hissa-i-Awali Behsud","Markaz-i-behsud")] <- 5
df$secure[df$province=="Zabul" & df$dist %in% c("Kakar")] <- 1
df$secure[df$province=="Zabul" & df$dist %in% c("Naw Bahar","Atghar","Arghandab","Daichopan","Mizan","Shemel Zayi")] <- 2
df$secure[df$province=="Zabul" & df$dist %in% c("Shinkai")] <- 3
df$secure[df$province=="Zabul" & df$dist %in% c("Shah Joi","Tarang Wa Jaldak")] <- 4
df$secure[df$province=="Zabul" & df$dist %in% c("Khak-e Afghan")] <- NA
df$secure <- factor(df$secure, ordered = T)
levels(df$secure) <- c("Not Active", "Insecure", "Somewhat Insecure", "Somewhat Secure", "Secure")
# birthyear
df$birthyear[df$birthyear==1234] <- 1334
### save v5
write_csv(df, "~/Documents/My Consultancies/IDLG District Governor's Report/DG data (March 19) v5.csv"); beep(2)
nAppoint <- df %>% filter(!is.na(firstname), startdate > nugIncept) %>% {.[, c("province", "district", "firstname", "startdate")]} %>% mutate(startdate = year(startdate)) %>% group_by(province, startdate) %>% tally %>%
spread(startdate, n) %>% mutate(appmt = sum(`1393`, `1394`, `1395`, `1396`, na.rm = T)) %>% arrange(desc(appmt))
recTot <- sum(nAppoint[[6]])
recTot
nAppoint %>% kable(col.names = c("Province", "1393*", "1394", "1395", "1396", "Total Appointments"), caption = "Number of Appointments of District Governors Since the Inception of NUG on `r nugIncept`")
options(knitr.kable.NA = "")
nAppoint %>% kable(col.names = c("Province", "1393*", "1394", "1395", "1396", "Total Appointments"), caption = "Number of Appointments of District Governors Since the Inception of NUG on `r nugIncept`")
incept
nugHired <- df %>% filter(!is.na(firstname), startdate > nugIncept)
nAppoint <-  %>% {.[, c("province", "district", "firstname", "startdate")]} %>% mutate(startdate = year(startdate)) %>% group_by(province, startdate) %>% tally %>%
recTot <- sum(nAppoint[[6]])
hired <- table(nugHired$competitiveHiring, useNA = "ifany") %>% prop.table() %>% {round(.*100, 1)} %>% data.frame()
hired
nAppoint <- nugHired %>% {.[, c("province", "district", "firstname", "startdate")]} %>% mutate(startdate = year(startdate)) %>% group_by(province, startdate) %>% tally %>%
spread(startdate, n) %>% mutate(appmt = sum(`1393`, `1394`, `1395`, `1396`, na.rm = T)) %>% arrange(desc(appmt))
recTot <- sum(nAppoint[[6]])
hired <- table(nugHired$competitiveHiring, useNA = "ifany") %>% prop.table() %>% {round(.*100, 1)} %>% data.frame()
hired
nugHired <- df %>% filter(!is.na(firstname), startdate > nugIncept)
nugHired
nAppoint <- nugHired %>% {.[, c("province", "district", "firstname", "startdate")]} %>% mutate(startdate = year(startdate)) %>% group_by(province, startdate) %>% tally %>%
spread(startdate, n) %>% mutate(appmt = sum(`1393`, `1394`, `1395`, `1396`, na.rm = T)) %>% arrange(desc(appmt))
nAppoint
recTot <- sum(nAppoint[[6]])
recTot
hired
table(nugHired$competitiveHiring, useNA = "ifany")
nugHired
df$education <- factor(df$education, levels = c("Master's degree", "Bachelor degree", "14th grade", "School certificate", "School incomplete", "Private education"))
df$majEthnic <- ifelse(df$ethnic == "Pashtun", "Pashtun",
ifelse(df$ethnic == "Tajik", "Tajik", ifelse(df$ethnic == "Hazara", "Hazara", ifelse(df$ethnic == "Uzbek", "Uzbek", ifelse(!is.na(df$ethnic), "Others", NA)))))
df$majEthnic <- factor(df$majEthnic, levels = c("Pashtun", "Tajik", "Hazara", "Uzbek", "Others"))
df$native <- as.character(df$native)
df$native <- ifelse(df$native == "TRUE", "Native", ifelse(df$native == "FALSE", "Non-native", NA))
df$competitiveHiring <- ifelse(df$dghiring=="Competitive", "Competitive", ifelse(is.na(df$dghiring), NA, "Uncompetitive")) %>% factor(ordered = T)
df <- mutate(df, startyear = year(df$startdate), startAge = startyear - birthyear,
ageGrps = ifelse(startAge<=30, 1, ifelse(startAge<=40, 2, ifelse(startAge<=50, 3, ifelse(startAge<=60, 4, 5)))))
df$ageGrps <- factor(df$ageGrps, labels = c("Up to 30", "31-40", "41-50", "51-60", "More than 60"))
df$secure <- factor(df$secure, levels = c("Not Active","Insecure","Somewhat Insecure","Somewhat Secure","Secure"), ordered = T)
df$native <- df$pob == df$province
df <- mutate(df, border=factor(border, labels=c("Without Border", "With Border")),
ports=factor(ports, labels=c("Without Port", "With Port")),
mines=factor(mines, labels=c("Without Mine", "With Mine")),
grade=factor(grade, labels=c("Grade 1", "Grade 2", "Grade 3")),
suburb=factor(suburb, labels=c("Not Adjacent to a Provincial Center", "Adjacent to a Provincial Center")),
highway=factor(highway, labels=c("Without Highway", "With Highway")),
native=factor(native, labels=c("Non-Native", "Native")))
df2 <- data.table(select(df, -interval))
df2 <- df2[, list(prov,district,firstname,fathername,pob,birthyear,ageGrps,majEthnic,competitiveHiring,education,native,polpartyaffiliation,pastpolpartyaffiliation,province,dist,status,secure,security,border,ports,mines,grade,suburb,highway, date = seq(startdate, enddate, by = "day")), by = 1:nrow(df)]
df2$age <- as.numeric((as.Date(df2$date) - as.Date(paste0(df2$birthyear, "-07-01")))/365)
df2$ageGrps2 <- if_else(df2$age<30.5, 1, if_else(df2$age<40.5, 2, if_else(df2$age<50.5, 3, if_else(df2$age<60.5, 4, 5))))
df2$ageGrps2 <- factor(df2$ageGrps2, labels = c("Up to 30", "31-40", "41-50", "51-60", "More than 60"))
nugIncept <- as.Date("1393-07-07")
incept <- format.Date(nugIncept, "%d/%m/%Y") %>% as.character()
nugHired <- df %>% filter(!is.na(firstname), startdate > nugIncept)
nAppoint <- nugHired %>% {.[, c("province", "district", "firstname", "startdate")]} %>% mutate(startdate = year(startdate)) %>% group_by(province, startdate) %>% tally %>%
spread(startdate, n) %>% mutate(appmt = sum(`1393`, `1394`, `1395`, `1396`, na.rm = T)) %>% arrange(desc(appmt))
hired <- table(nugHired$competitiveHiring, useNA = "ifany") %>% prop.table() %>% {round(.*100, 1)} %>% data.frame()
hired
incept
recTot
hired[2,2]
dismiss
dismiss <- nugHired %>% filter(enddate < as.Date("1396-12-30")) %>% nrow()
dismiss
dismiss
dismissLen <- nugHired %>% filter(enddate < as.Date("1396-12-30")) %>% mutate(int = as.numeric(enddate - startdate)) %>% select(int) %>% {sum(.)/dismiss} %>% round(1)
dismissLen
table(nugHired$competitiveHiring, useNA = "ifany")
table(nugHired$competitiveHiring, useNA = "ifany")
nugHired %>% filter(enddate < as.Date("1396-12-30"))
nugHired %>% filter(enddate < as.Date("1396-12-30")) %>% mutate(int = enddate - startdate)
nugHired %>% filter(enddate < as.Date("1396-12-30")) %>% mutate(int = enddate - startdate) %>% arrange(desc(int))
nugHired %>% filter(enddate < as.Date("1396-12-30")) %>% mutate(int = enddate - startdate) %>% arrange(desc(int)) %>% select(int)
nugHired %>% filter(enddate < as.Date("1396-12-30")) %>% mutate(int = enddate - startdate) %>% arrange(desc(int)) %>% select(int) %>%
ggplot(aes(int)) + geom_histogram(fill = "navy") + theme_bw() + labs(x = "Duration in Days", fill = "", title = "")
nugHired %>% filter(enddate < as.Date("1396-12-30")) %>% mutate(int = enddate - startdate) %>% arrange(desc(int)) %>% select(int) %>%
ggplot(aes(int)) + geom_histogram(fill = "navy") + theme_bw() + labs(x = "Duration in Days", title = "")
nugHired %>% filter(enddate < as.Date("1396-12-30")) %>% mutate(int = enddate - startdate) %>% arrange(desc(int)) %>% select(int) %>%
ggplot(aes(int)) + geom_histogram(fill = "navy") + theme_bw() + labs(x = "Duration in Days", Y = "Count")
nugHired
nugHired$competitiveHiring
nugHired$competitiveHiring %>% table()
nugHired$competitiveHiring %>% table(useNA = "ifany")
appnt <- nugHired$competitiveHiring %>% table(useNA = "ifany")
appnt <- nugHired$competitiveHiring %>% table(useNA = "ifany") %>% data.frame()
appnt
appnt
appnt[1]
appnt[2]
appnt[2, 2]
nugHired %>% filter(enddate < as.Date("1396-12-30")) %>% mutate(int = enddate - startdate) %>% arrange(desc(int)) %>% select(int) %>%
ggplot(aes(int)) + geom_histogram(fill = "navy") + theme_bw() + labs(x = "Duration in Days", Y = "Count")
df2[, c("province", "dist", "date", "competitiveHiring")]
df2[, c("province", "dist", "date", "competitiveHiring")] %>% group_by(date, competitiveHiring) %>% tally
df2[, c("province", "dist", "date", "competitiveHiring")] %>% group_by(date, competitiveHiring) %>% tally %>% ggplot(aes(date, n, fill = competitiveHiring)) + geom_area()
data.frame(seq, rec) %>% filter(seq > as.Date("1393-01-01")) %>% ggplot(aes(seq, rec)) + geom_line(alpha = .5) + geom_point(size = .4, alpha = .4) + geom_vline(xintercept = nugIncept, col = "red") + theme_bw() +
labs(x = "", y = "Number of Appointments")
nugHired %>% filter(enddate < as.Date("1396-12-30")) %>% mutate(int = enddate - startdate) %>% arrange(desc(int)) %>% select(int) %>%
ggplot(aes(int)) + geom_histogram(fill = "navy") + theme_bw() + labs(x = "Duration in Days", Y = "Count")
df2[, c("province", "dist", "date", "competitiveHiring")] %>% group_by(date, competitiveHiring) %>% tally %>% ggplot(aes(date, n, fill = competitiveHiring)) + geom_area() + theme_bw()
df2[, c("province", "dist", "date", "competitiveHiring")] %>% group_by(date, competitiveHiring) %>% tally %>% ggplot(aes(date, n, fill = competitiveHiring)) + geom_area() + theme_bw() +
labs(x = "", y = "Count", fill = "")
df2[, c("province", "dist", "date", "competitiveHiring")] %>% group_by(date, competitiveHiring) %>% tally %>% ggplot(aes(date, n, fill = competitiveHiring)) + geom_area() + theme_bw() +
labs(x = "", y = "Count", fill = "Type of\nAppointment")
df2[, c("province", "dist", "date", "competitiveHiring")] %>% group_by(date, competitiveHiring) %>% tally %>% ggplot(aes(date, n, fill = competitiveHiring)) + geom_area() + theme_bw() +
labs(x = "", y = "Count", fill = "Type of\nAppointment") + geom_vline(xintercept = nugIncept)
df2[, c("province", "dist", "date", "competitiveHiring")] %>% group_by(date, competitiveHiring) %>% tally %>% ggplot(aes(date, n, fill = competitiveHiring)) + geom_area() + theme_bw() +
labs(x = "", y = "Count", fill = "Type of\nAppointment") + geom_vline(xintercept = nugIncept, col = "red")
df2[, c("province", "dist", "date", "competitiveHiring")] %>% group_by(date, competitiveHiring) %>% tally %>% ggplot(aes(date, n, fill = competitiveHiring)) + geom_area() + theme_bw() +
labs(x = "", y = "Count", fill = "Type of\nAppointment") + geom_vline(xintercept = nugIncept, col = "navy")
nugHired %>% filter(enddate < as.Date("1396-12-30")) %>% mutate(int = enddate - startdate) %>% arrange(desc(int)) %>% select(int) %>%
ggplot(aes(int)) + geom_histogram(fill = "navy") + theme_bw() + labs(x = "Duration in Days", Y = "Count")
df2[, c("province", "dist", "date", "competitiveHiring", "secure")]
names(df2)
names(df2)
table(df2$secure)
df2[, c("province", "dist", "date", "competitiveHiring", "secure")] %>% group_by(date, competitiveHiring, secure) %>% tally
df2[, c("province", "dist", "date", "competitiveHiring", "secure")] %>% group_by(date, competitiveHiring, secure) %>% tally %>% ggplot(aes(date, n, fill = competitiveHiring)) + geom_area() + theme_bw() +
facet_wrap(~secure) +
labs(x = "", y = "Count", fill = "Type of\nAppointment") + geom_vline(xintercept = nugIncept, col = "navy")
df2[, c("province", "dist", "date", "competitiveHiring", "secure")] %>% group_by(date, competitiveHiring, secure) %>% tally %>% ggplot(aes(date, n, fill = competitiveHiring)) + geom_area(position = "fill") + theme_bw() +
facet_wrap(~secure) + labs(x = "", y = "Count", fill = "Type of\nAppointment") + geom_vline(xintercept = nugIncept, col = "navy")
df2[, c("province", "dist", "date", "competitiveHiring", "secure")] %>% group_by(date, competitiveHiring, secure) %>% tally %>% filter(!is.na(competitiveHiring)) %>%
ggplot(aes(date, n, fill = competitiveHiring)) + geom_area(position = "fill") + theme_bw() + facet_wrap(~secure) + labs(x = "", y = "Count", fill = "Type of\nAppointment") + geom_vline(xintercept = nugIncept, col = "navy")
df2[, c("province", "dist", "date", "competitiveHiring", "secure")] %>% group_by(date, competitiveHiring, secure) %>% tally %>% filter(!is.na(secure)) %>%
ggplot(aes(date, n, fill = competitiveHiring)) + geom_area(position = "fill") + theme_bw() + facet_wrap(~secure) + labs(x = "", y = "Count", fill = "Type of\nAppointment") + geom_vline(xintercept = nugIncept, col = "navy")
df2[, c("province", "dist", "date", "competitiveHiring", "secure")] %>% group_by(date, competitiveHiring, secure) %>% tally %>% filter(!is.na(secure)) %>%
ggplot(aes(date, n, fill = competitiveHiring)) + geom_area(position = "fill") + theme_bw() + facet_wrap(~secure) + labs(x = "", y = "Count", fill = "Type of\nAppointment") + geom_vline(xintercept = nugIncept, col = "navy")
df2[, c("province", "dist", "date", "competitiveHiring", "secure")] %>% group_by(date, competitiveHiring, secure) %>% tally %>% filter(!is.na(secure)) %>%
ggplot(aes(date, n, fill = competitiveHiring)) + geom_area(position = "fill") + theme_bw() + facet_wrap(~secure) + labs(x = "", y = "Count", fill = "Type of\nAppointment") + geom_vline(xintercept = nugIncept, col = "navy") +
theme(axis.text.x = element_text(angle = 90, vjust = .5), plot.title = element_text(hjust = .5))
df2[, c("province", "dist", "date", "competitiveHiring")] %>% group_by(date, competitiveHiring) %>% tally %>% ggplot(aes(date, n, fill = competitiveHiring)) + geom_area() + theme_bw() +
labs(x = "", y = "Count", fill = "Type of\nAppointment") + geom_vline(xintercept = nugIncept, col = "navy")
df2[, c("province", "dist", "date", "competitiveHiring", "secure")] %>% group_by(date, competitiveHiring, secure) %>% tally %>% filter(!is.na(secure)) %>%
ggplot(aes(date, n, fill = competitiveHiring)) + geom_area(position = "fill") + theme_bw() + facet_wrap(~secure) + labs(x = "", y = "Count", fill = "Type of\nAppointment") + geom_vline(xintercept = nugIncept, col = "navy") +
theme(axis.text.x = element_text(angle = 90, vjust = .5), plot.title = element_text(hjust = .5))
df2[, c("province", "dist", "date", "competitiveHiring", "grade")] %>% group_by(date, competitiveHiring, grade) %>% tally %>% filter(!is.na(grade)) %>%
ggplot(aes(date, n, fill = competitiveHiring)) + geom_area(position = "fill") + theme_bw() + facet_wrap(~grade) + labs(x = "", y = "Count", fill = "Security") + geom_vline(xintercept = nugIncept, col = "navy") +
theme(axis.text.x = element_text(angle = 90, vjust = .5), plot.title = element_text(hjust = .5))
df2[, c("province", "dist", "date", "competitiveHiring", "ageGrps2")] %>% group_by(date, competitiveHiring, ageGrps2) %>% tally %>% filter(!is.na(ageGrps2)) %>%
ggplot(aes(date, n, fill = competitiveHiring)) + geom_area(position = "fill") + theme_bw() + facet_wrap(~ageGrps2) + labs(x = "", y = "Count", fill = "Age") + geom_vline(xintercept = nugIncept, col = "navy") +
theme(axis.text.x = element_text(angle = 90, vjust = .5), plot.title = element_text(hjust = .5))
df2[, c("province", "dist", "date", "competitiveHiring", "education")] %>% group_by(date, competitiveHiring, education) %>% tally %>% filter(!is.na(education)) %>%
ggplot(aes(date, n, fill = competitiveHiring)) + geom_area(position = "fill") + theme_bw() + facet_wrap(~education) + labs(x = "", y = "Count", fill = "Education") + geom_vline(xintercept = nugIncept, col = "navy") +
theme(axis.text.x = element_text(angle = 90, vjust = .5), plot.title = element_text(hjust = .5))
df2[, c("province", "dist", "date", "competitiveHiring", "majEthnic")] %>% group_by(date, competitiveHiring, majEthnic) %>% tally %>% filter(!is.na(majEthnic)) %>%
ggplot(aes(date, n, fill = competitiveHiring)) + geom_area(position = "fill") + theme_bw() + facet_wrap(~majEthnic) + labs(x = "", y = "Count", fill = "Education") + geom_vline(xintercept = nugIncept, col = "navy") +
theme(axis.text.x = element_text(angle = 90, vjust = .5), plot.title = element_text(hjust = .5))
df2[, c("province", "dist", "date", "competitiveHiring", "native")] %>% group_by(date, competitiveHiring, native) %>% tally %>% filter(!is.na(native)) %>%
ggplot(aes(date, n, fill = competitiveHiring)) + geom_area(position = "fill") + theme_bw() + facet_wrap(~native) + labs(x = "", y = "Count", fill = "") + geom_vline(xintercept = nugIncept, col = "navy") +
theme(axis.text.x = element_text(angle = 90, vjust = .5), plot.title = element_text(hjust = .5))
df2[, c("province", "dist", "date", "competitiveHiring", "majEthnic")] %>% group_by(date, competitiveHiring, majEthnic) %>% tally %>% filter(!is.na(majEthnic)) %>%
ggplot(aes(date, n, fill = competitiveHiring)) + geom_area(position = "fill") + theme_bw() + facet_wrap(~majEthnic) + labs(x = "", y = "Count", fill = "Ethnicity") + geom_vline(xintercept = nugIncept, col = "navy") +
theme(axis.text.x = element_text(angle = 90, vjust = .5), plot.title = element_text(hjust = .5))
df2[, c("province", "dist", "date", "competitiveHiring", "majEthnic")] %>% group_by(date, competitiveHiring, majEthnic) %>% tally %>% filter(!is.na(majEthnic)) %>%
ggplot(aes(date, n, fill = competitiveHiring)) + geom_area(position = "fill") + theme_bw() + facet_wrap(~majEthnic) + labs(x = "", y = "Count", fill = "Type of\nAppointment") + geom_vline(xintercept = nugIncept, col = "navy") +
theme(axis.text.x = element_text(angle = 90, vjust = .5), plot.title = element_text(hjust = .5))
df2[, c("province", "dist", "date", "competitiveHiring", "native")] %>% group_by(date, competitiveHiring, native) %>% tally %>% filter(!is.na(native)) %>%
ggplot(aes(date, n, fill = competitiveHiring)) + geom_area(position = "fill") + theme_bw() + facet_wrap(~native) + labs(x = "", y = "Count", fill = "Type of\nAppointment") + geom_vline(xintercept = nugIncept, col = "navy") +
theme(axis.text.x = element_text(angle = 90, vjust = .5), plot.title = element_text(hjust = .5))
require(blogdown)
build_site()
setwd("~/Documents/GitHub/hugoblogs/octopress")
blogdown::serve_site()
setwd("~/Documents/GitHub/hugoblogs/smorg")
blogdown::new_site(theme = "solutionroute/hugo-smorg")
